<!doctype html>
<html lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/zh-CN/blog/rss.xml" title="Nocalhost Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/blog/atom.xml" title="Nocalhost Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Nocalhost" href="/zh-CN/opensearch.xml">
<link rel="icon" href="/zh-CN/img/favicon.ico">
<link rel="manifest" href="/zh-CN/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><title data-react-helmet="true">1 篇文章 文章标记 &quot;microservice&quot; | Nocalhost</title><meta data-react-helmet="true" property="og:title" content="1 篇文章 文章标记 &quot;microservice&quot; | Nocalhost"><meta data-react-helmet="true" property="og:url" content="https://nocalhost.dev//zh-CN/blog/tags/microservice"><meta data-react-helmet="true" name="docsearch:language" content="zh-CN"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-react-helmet="true" rel="shortcut icon" href="/zh-CN/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://nocalhost.dev//zh-CN/blog/tags/microservice"><link data-react-helmet="true" rel="alternate" href="https://nocalhost.dev//blog/tags/microservice" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://nocalhost.dev//zh-CN/blog/tags/microservice" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://nocalhost.dev//blog/tags/microservice" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh-CN/assets/css/styles.e982e9c5.css">
<link rel="preload" href="/zh-CN/assets/js/runtime~main.c2a025a3.js" as="script">
<link rel="preload" href="/zh-CN/assets/js/main.27de8f31.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">跳到主要内容</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarContent_3EUC announcementBarCloseable_3myR">⭐️ If you like Nocalhost, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/nocalhost/nocalhost">GitHub</a>! ⭐</div><button type="button" class="announcementBarClose_38nx clean-btn" aria-label="关闭"><span aria-hidden="true">×</span></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><img src="/zh-CN/img/logo.png" alt="Most productive cloud-native development toolsets" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh-CN/img/logo.png" alt="Most productive cloud-native development toolsets" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Nocalhost</b></a><a class="navbar__item navbar__link" href="/zh-CN/docs/introduction">文档</a><a class="navbar__item navbar__link" href="/zh-CN/videos">视频</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-CN/blog">博客</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文（中国）</span></span></a><ul class="dropdown__menu"><li><a href="/blog/tags/microservice" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh-CN/blog/tags/microservice" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文（中国）</a></li></ul></div><a href="https://github.com/nocalhost/nocalhost" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="近期博客内容导航"><div class="sidebarItemTitle_2hhb margin-bottom--md">All our posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh-CN/blog/docs-translate">Nocalhost 官方文档翻译活动</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh-CN/blog/2021/07/05/jimmy">如何调试 Kubernetes 中的微服务 ——proxy、sidecar 还是 service mesh？</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh-CN/blog/2021/01/01/">重新定义云原生开发环境</a></li></ul></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>1 篇文章 文章标记 &quot;microservice&quot;</h1><a href="/zh-CN/blog/tags">查看所有标签</a></header><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/zh-CN/blog/2021/07/05/jimmy">如何调试 Kubernetes 中的微服务 ——proxy、sidecar 还是 service mesh？</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-07-05T00:00:00.000Z">July 5, 2021</time> · 阅读时间: 2 分钟</div><div class="avatar margin-vert--md"><a href="https://github.com/rootsongjc" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/3328185?v=4" alt="Jimmy Song"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/rootsongjc" target="_blank" rel="noopener noreferrer">Jimmy Song</a></div><small class="avatar__subtitle">Developer advocate at Tetrate</small></div></div></header><div class="markdown"><blockquote><p>此博文首次发表于 <a href="https://jimmysong.io/en/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/" target="_blank" rel="noopener noreferrer">Jimmy 的博客</a></p></blockquote><p>本文讲解了调试 Kubernetes 中微服务的三种模式/工具，以及 Istio 的引入为微服务的调试带来的变革。</p><p>Kubernetes 可以说是目前为止用来运行微服务的最佳载体，但是在调试 Kubernetes 环境中的微服务时的体验可能就没那么友好了。本文将带你了解如何调试 Kubernetes 中的微服务，介绍常用的工具，以及 Istio 的引入为微服务的调试带来的变革。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="调试微服务与传统单体应用有巨大的不同"></a>调试微服务与传统单体应用有巨大的不同<a class="hash-link" href="#调试微服务与传统单体应用有巨大的不同" title="直接链接到标题">#</a></h2><p>微服务的调试是一直长期困扰软件开发人员的问题，这在传统的单体应用中不存在，因为开发者可以利用 IDE 中的调试器，为应用程序增加断点、修改环境变量，单步执行等，这些都为软件调试提供了巨大帮助。随着 Kubernetes 的流行，微服务的调试就成了一个棘手的问题，其中相比传统单体应用的调试多了以下问题：</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="多依赖"></a>多依赖<a class="hash-link" href="#多依赖" title="直接链接到标题">#</a></h3><p>一个微服务往往依赖多个其他微服务，在调试某个微服务时，如何部署其他依赖服务以快速搭建一套最新的 stagging 环境？</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="从本地机器访问"></a>从本地机器访问<a class="hash-link" href="#从本地机器访问" title="直接链接到标题">#</a></h3><p>微服务在开发者的本地电脑上运行时，通常无法直接访问到 Kubernetes 集群中的服务，如何像调试本地服务一样调试部署在 Kubernetes 集群中的微服务？</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="开发效率低下"></a>开发效率低下<a class="hash-link" href="#开发效率低下" title="直接链接到标题">#</a></h3><p>通常情况下，代码从更新到构建成镜像再推送到集群中需要一个漫长的过程，如何加快开发速度？</p><p>我们一起来看下哪些工具能够解决以上问题。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="工具"></a>工具<a class="hash-link" href="#工具" title="直接链接到标题">#</a></h2><p>调试 Kubernetes 中的微服务的主要解决方案有：</p><ul><li>Proxy：在 Kubernetes 集群和本地调试终端中部署一个代理，通过构建一个 VPN，使得本地应用可以直接访问到 Kubernetes 中的服务；</li><li>Sidecar：替换原来应用容器的镜像为开发镜像，可以在这个容器中中对该服务进行调试，同时在要调试的微服务 pod 中注入一个 sidecar 作为辅助工具来同步代码；</li><li>服务网格：要想了解应用的整体情况，就需要在所有微服务中注入 sidecar，这样你就可以获得一个监控全局状态的仪表板；</li></ul><p>下面是实现以上解决方案的三个典型的开源项目，它们分别从不同的角度可以帮助你调试微服务。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="proxy-模式：telepresence"></a>Proxy 模式：Telepresence<a class="hash-link" href="#proxy-模式：telepresence" title="直接链接到标题">#</a></h3><p><a href="https://www.telepresence.io/" target="_blank" rel="noopener noreferrer">Telepresence</a> 本质上是一个本地代理，该代理将 Kubernetes 集群中的数据卷、环境变量、网络都代理到了本地。下图展示的是 Teleprence 的主要使用场景。</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/how-to-debug-microservices/telepresence.jpeg"><figcaption>Proxy 模式: Telepresence</figcaption></figure><p>用户需要在本地自主地执行 <code>telepresence</code> 命令，它会自动将代理部署到 Kubernetes 中，有了该代理之后：</p><ul><li>本地的服务就可以完整的访问到 Kubernetes 集群中的其他服务、环境变量、Secret、ConfigMap 等；</li><li>集群中的服务还能直接访问到本地暴露出来的端点；</li></ul><p>但是这种方式仍然不够连贯，还需要用户在本地调试时运行多次命令，而且在某些网络环境下可能无法与 Kubernetes 集群建立 VPN 连接。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sidecar-模式：nocalhost"></a>Sidecar 模式：Nocalhost<a class="hash-link" href="#sidecar-模式：nocalhost" title="直接链接到标题">#</a></h3><p><a href="https://nocalhost.dev/" target="_blank" rel="noopener noreferrer">Nocalhost</a> 是一个基于 Kubernetes 的云端开发工具。要想使用它，你只需要在你的 IDE （如VS Code） 中安装一个插件即可扩展 Kubernetes，并缩短开发反馈周期。通过为不同的用户创建不同的 namespace，并使用 ServiceAccount 绑定到不同用户角身上时，就可以实现开发环境隔离。同时，Nocalhost 还提供了 Web 控制台和 API，方便管理员来管理不同的开发环境。</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/how-to-debug-microservices/sidecar-nocalhost.jpeg"><figcaption>Sidecar 模式: Nocalhost</figcaption></figure><p>只要你有一个 Kubernetes 集群，并且拥有集群的管理员权限，就可以参考 <a href="/zh-CN/docs/quick-start">Nocalhost 快速开始</a> 试用 Nocalhost。 要在 VS Code 中使用 Nocalhost 插件，需要先在插件中配置 Kubernetes 集群。</p><ol><li>选择刚刚导出的 KubeConfig 文件或者直接复制粘贴文件内容到配置中</li><li>然后选择需要测试的服务，选择对应的 DevContainer, VS Code 会自动打开一个新的代码窗口。</li></ol><p>这是 Istio 提供的 <a href="https://istio.io/latest/docs/examples/bookinfo/" target="_blank" rel="noopener noreferrer">bookinfo sample</a> 示例。 您可以在本地 IDE 中打开克隆的代码，然后单击代码文件旁边的锤子进入开发模式。 选择对应的 DevContainer，Nocalhost，会自动在pod中注入一个开发容器sidecar，在终端自动进入容器，如下图所示。</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/how-to-debug-microservices/nocalhost-vs-code.jpeg"><figcaption>Nocalhost VS Code</figcaption></figure><p>在开发模式下，如果你在本地修改代码，Nocalhost 会自动将代码同步到远端容器，实现代码修改结果在远程开发环境实时生效，无需重建镜像，可大大加快开发速度。 同时，Nocalhost 还提供了管理开发环境和用户权限的服务器，如下图所示:</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/how-to-debug-microservices/nocalhost-web-admin.jpeg"><figcaption>Nocalhost 服务端</figcaption></figure><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="service-mesh-模式：istio"></a>Service Mesh 模式：Istio<a class="hash-link" href="#service-mesh-模式：istio" title="直接链接到标题">#</a></h3><p>以上使用 proxy 和 sidecar 的方式，一次只能对一个服务进行调试，如果想要掌握服务的全局状况，比如获取的服务的指标，以及通过分布式追踪了解服务的依赖和调用流程，对服务的性能进行调试。这些<a href="https://istio.io/latest/zh/docs/concepts/observability/" target="_blank" rel="noopener noreferrer">可观察性</a>的功能，需要为所有服务统一注入 sidecar 来实现。</p><p>而且，当你的服务正处于从虚拟机迁移到 Kubernetes 的过程中时，使用 Istio 可以将虚拟机与 Kubernetes 纳入一个网络平面中（如下图所示），方便开发者调试和做渐进式的迁移。</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/how-to-debug-microservices/istio-service-mesh.jpeg"><figcaption>Service Mesh mode: Istio</figcaption></figure><p>当然要获得这些好处也不是一点“代价”也不没有的，引入 Istio 后，你的 Kubernetes service 需要遵守 Istio 的<a href="https://istio.io/latest/zh/docs/ops/deployment/requirements/" target="_blank" rel="noopener noreferrer">命名规范</a>，学习使用 <a href="https://istio.io/latest/docs/ops/diagnostic-tools/istioctl-analyze/" target="_blank" rel="noopener noreferrer">Istioctl</a> 命令行和日志的方式来调试微服务。</p><ul><li>使用 <code>istioctl analyze</code> 命令来调试集群中的微服务部署情况，可以使用 YAML 文件来检查某个命名空间或整个集群中的资源部署情况。</li><li>使用 <code>istioctl proxy-config secret</code> 来调试 service mesh 中的 pod 的 secret 被正确的加载并有效。</li></ul><p>Istio 的配置信息在大型的集群部署中传播将会耗时更长并且可能有几秒钟的延迟时间，sidecar 的引入会给服务间调用带来一定延迟。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="总结"></a>总结<a class="hash-link" href="#总结" title="直接链接到标题">#</a></h2><p>在应用微服务化和从虚拟机迁移到 Kubernetes 的过程中，开发者需要很多观念和习惯上的转变。通过 proxy 在本地跟 Kubernetes 间构建 VPN，可以方便开发者像调试本地服务一样调试 Kubernetes 中的服务。通过向 pod 中注入 sidecar，可以实现实时调试，加快开发进度。最后，Istio service mesh 真正实现了全局的可观察性，你还可以使用像 <a href="https://www.tetrate.io/tetrate-service-bridge/" target="_blank" rel="noopener noreferrer">Tetrate Service Bridge</a> 这样的工具来管理异构平台，帮助你渐渐地从单体应用过度到微服务。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签:</b><a class="margin-horiz--sm" href="/zh-CN/blog/tags/kubernetes">Kubernetes</a><a class="margin-horiz--sm" href="/zh-CN/blog/tags/cloud-native">Cloud-Native</a><a class="margin-horiz--sm" href="/zh-CN/blog/tags/microservice">Microservice</a></div><div class="col text--right"><a aria-label="Read more about 如何调试 Kubernetes 中的微服务 ——proxy、sidecar 还是 service mesh？" href="/zh-CN/blog/2021/07/05/jimmy"><b>阅读更多</b></a></div></footer></article></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/quick-start">快速开始</a></li><li class="footer__item"><a href="https://github.com/nocalhost/nocalhost" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/introduction">文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a href="https://nocalhost.slack.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/nocalhost" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/nocalhost/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/blog">博客</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">版权所有 © 2021 Nocalhost | 项目由 <a href="https://coding.net/" target="_blank">Coding.net</a> 发起</div></div></div></footer></div>
<script src="/zh-CN/assets/js/runtime~main.c2a025a3.js"></script>
<script src="/zh-CN/assets/js/main.27de8f31.js"></script>
</body>
</html>